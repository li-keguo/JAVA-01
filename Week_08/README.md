## 作业总览

### Week08 作业题目（周三）：

1.（选做）分析前面作业设计的表，是否可以做垂直拆分。

2.（必做）设计对前面的订单表数据进行水平分库分表，拆分 2 个库，每个库 16 张表。并在新结构在演示常见的增删改查操作。代码、sql 和配置文件，上传到 Github。

3.（选做）模拟 1000 万的订单单表数据，迁移到上面作业 2 的分库分表中。

4.（选做）重新搭建一套 4 个库各 64 个表的分库分表，将作业 2 中的数据迁移到新分库。

### Week08 作业题目（周日）：
1.（选做）列举常见的分布式事务，简单分析其使用场景和优缺点。

2.（必做）基于 hmily TCC 或 ShardingSphere 的 Atomikos XA 实现一个简单的分布式事务应用 demo（二选一），提交到 Github。

3.（选做）基于 ShardingSphere narayana XA 实现一个简单的分布式事务 demo。

4.（选做）基于 seata 框架实现 TCC 或 AT 模式的分布式事务 demo。

5.（选做☆）设计实现一个简单的 XA 分布式事务框架 demo，只需要能管理和调用 2 个 MySQL 的本地事务即可，不需要考虑全局事务的持久化和恢复、高可用等。

6.（选做☆）设计实现一个 TCC 分布式事务框架的简单 Demo，需要实现事务管理器，不需要实现全局事务的持久化和恢复、高可用等。

7.（选做☆）设计实现一个 AT 分布式事务框架的简单 Demo，仅需要支持根据主键 id 进行的单个删改操作的 SQL 或插入操作的事务。

### 完成情况

#### 分库分表
首先尝试使用自建的订单表进行分库分表，
分库：xm_db_01,xm_db_0
分表：xm_shopping_order_(0-15)
遇到的问题及解决
1.使用yml文档进行配置，使用新版的spring boot（2.xx以上）的时候出现版本配置差异，报错
2.yml配置配置老是出问题，最终使用properties的方式，（可能与数据库表命名带有下划线有关，yml中不支持）
3.分片语句用到的列名在表中不存在，导致数据插入的时候，对每个分库和分表都插入相同的数据
4.第一次配置使用自己新建的表，老是出问题，无奈之下使用官方案例提供的demo，调通后换成自己的表进行调试
#### 使用ShardingSphere中提供的xa事务
XA :遇到问题

1.使用XA在shardingsphere-jdbc-core-spring-boot-starter基础上引入shardingsphere-transaction-xa-core
2.多数据源配置一定不能有重复数据库出现，会死锁
3.使用XA需要数据库开启对连接的用户开启权限，root用户默认没有XA_RECOVER_ADMIN权限：GRANT XA_RECOVER_ADMIN ON *.* TO root@'%';

后续：工作原因，写作业时间有限，对TCC感兴趣，周天研究补上