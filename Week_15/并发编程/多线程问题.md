### 多线程问题

核心矛盾：CPU、 内存、 I/O设备之间的速度差异

#### 解决方法

##### 硬件方面

CPU多级缓存：CPU增加缓存，以均衡与内存的速度差异

多核心：CPU为增加处理能力，装载多个核心，每个都可以看做单独CPU

##### 软件方面

进程和线程：系统引入进程、线程概念，分时复用CPU，均衡与I/O读写速度差异

编译优化：编译器优化指令执行顺序，是的缓存充分利用

#### 引入问题

有序性：编译优化提升了性能，但指令执行的顺序不能保证，线程间争抢CPU时间片，

可见性：CPU不同核心之间缓存不可见，线程与线程，进程与进程之间的数据不可见

原子性：一串连续且必须具备原子操作的指令，在多线程，多核心执行的情况下，很难保证其有序和独占单个核心执行，无法保证其原子性。

###### 解决办法

原子性，通过加锁的方式对原子性操作隔离执行

可见性，通过禁用编译优化，或者指定共享变量禁用缓存

有序性，还是通过加锁的方式，使得执行遵循happen before原则



